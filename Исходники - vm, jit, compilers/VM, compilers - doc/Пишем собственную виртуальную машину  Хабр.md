---
created: 2023-02-05T17:21:15 (UTC +03:00)
tags: [LC-3,виртуальная машина,VM,ассемблер для начинающих,NES]
source: https://habr.com/ru/post/434138/
author: Анатолий Ализар
---

# Пишем собственную виртуальную машину / Хабр

> ## Excerpt
> В этом руководстве я расскажу, как написать собственную виртуальную машину (VM), способную запускать программы на ассемблере, такие как 2048 (моего друга) или Ro...

---
В этом руководстве я расскажу, как написать собственную виртуальную машину (VM), способную запускать программы на ассемблере, такие как [2048](https://github.com/rpendleton/lc3-2048) (моего друга) или [Roguelike](https://github.com/justinmeiners/lc3-rogue) (моя). Если вы умеете программировать, но хотите лучше понять, что происходит внутри компьютера и как работают языки программирования, то этот проект для вас. Написание собственной виртуальной машины может показаться немного страшным, но я обещаю, что тема удивительно простая и поучительная.

[Окончательный код](https://justinmeiners.github.io/lc3-vm/src/lc3.c) составляет около 250 строк на C. Достаточно знать лишь основы C или C++, такие как [двоичная арифметика](https://www.swarthmore.edu/NatSci/echeeve1/Ref/BinaryMath/BinaryMath.html). Для сборки и запуска подходит любая Unix-система (включая macOS). Несколько API Unix используются для настройки ввода и отображения консоли, но они не являются существенными для основного кода. (Реализация поддержки Windows приветствуется).

> **Примечание:** эта VM — [грамотная программа](https://en.wikipedia.org/wiki/Literate_programming). То есть вы прямо сейчас уже читаете её исходный код! Каждый фрагмент кода будет показан и подробно объяснён, так что можете быть уверены: ничего не упущено. Окончательный код создан [сплетением](https://github.com/zyedidia/Literate) блоков кода. Репозиторий проекта [тут](https://github.com/justinmeiners/lc3-vm).

## 1\. Оглавление

  

1.  [Оглавление](https://habr.com/ru/post/434138/#1)
2.  [Введение](https://habr.com/ru/post/434138/#2)
3.  [Архитектура LC-3](https://habr.com/ru/post/434138/#3)
4.  [Примеры на ассемблере](https://habr.com/ru/post/434138/#4)
5.  [Выполнение программ](https://habr.com/ru/post/434138/#5)
6.  [Реализация инструкций](https://habr.com/ru/post/434138/#6)
7.  [Шпаргалка по инструкциям](https://habr.com/ru/post/434138/#7)
8.  [Процедуры обработки прерываний](https://habr.com/ru/post/434138/#8)
9.  [Шпаргалка по процедурам обработки прерываний](https://habr.com/ru/post/434138/#9)
10.  [Загрузка программ](https://habr.com/ru/post/434138/#10)
11.  [Отображаемые в памяти регистры](https://habr.com/ru/post/434138/#11)
12.  [Особенности платформы](https://habr.com/ru/post/434138/#12)
13.  [Запуск виртуальной машины](https://habr.com/ru/post/434138/#13)
14.  [Альтернативный метод на C++](https://habr.com/ru/post/434138/#14)

  

## 2\. Введение

  

### Что такое виртуальная машина?

Виртуальная машина — это программа, которая действует как компьютер. Она имитирует процессор с несколькими другими аппаратными компонентами, позволяя выполнять арифметику, считывать из памяти и записывать туда, а также взаимодействовать с устройствами ввода-вывода, словно настоящий физический компьютер. Самое главное, VM понимает машинный язык, который вы можете использовать для программирования.

Сколько аппаратного обеспечения имитирует конкретная VM — зависит от её предназначения. Некоторые VM воспроизводят поведение одного конкретного компьютера. У людей больше нет NES, но мы всё ещё можем играть в игры для NES, имитируя аппаратное обеспечение на программном уровне. Эти эмуляторы должны [точно воссоздать](http://wiki.nesdev.com/w/index.php/Tricky-to-emulate_games) каждую [деталь](http://wiki.nesdev.com/w/index.php/Emulator_tests) и каждый основной аппаратный компонент оригинального устройства.

Другие VM не соответствуют никакому конкретному компьютеру, а частично соответствуют сразу нескольким! В первую очередь это делается для облегчения разработки ПО. Представьте, что вы хотите создать программу, работающую на нескольких компьютерных архитектурах. Виртуальная машина даёт стандартную платформу, которая обеспечивает переносимость. Не нужно переписывать программу на разных диалектах ассемблера для каждой архитектуры. Достаточно сделать только небольшую VM на каждом языке. После этого любую программу можно написать лишь единожды на языке ассемблера виртуальной машины.

![](data:image/gif;base64,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)

![](data:image/gif;base64,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)

  

> **Примечание:** компилятор решает подобные проблемы, компилируя стандартный _высокоуровневый язык_ для разных процессорных архитектур. VM создаёт одну стандартную _архитектуру CPU_, которая симулируется на различных аппаратных устройствах. Одно из преимуществ компилятора в том, что отсутствуют накладные расходы во время выполнения, как у VM. Хотя компиляторы хорошо работают, написание нового компилятора для нескольких платформ очень трудно, поэтому VM всё ещё полезны. В реальности на разных уровнях и VM, и компиляторы используются совместно.

[Виртуальная машина Java (JVM)](https://en.wikipedia.org/wiki/Java_virtual_machine) — очень успешный пример. Сама JVM относительно среднего размера, она достаточно мала для понимания программистом. Это позволяет писать код для тысяч разнообразных устройств, включая телефоны. После реализации JVM на новом устройстве любая написанная программа Java, Kotlin или Clojure может работать на нём без изменений. Единственными затратами будут только накладные расходы на саму VM и [дальнейшее абстрагирование](https://www.joelonsoftware.com/2002/11/11/the-law-of-leaky-abstractions/) от машинного уровня. Обычно это довольно хороший компромисс.

VM не обязательно должна быть большой или вездесущной, чтобы обеспечить аналогичные преимущества. Старые [видеоигры](https://fabiensanglard.net/anotherWorld_code_review/) часто использовали небольшие VM для создания простых [скриптовых систем](https://sf2platinum.wordpress.com/page/1/).

VM также полезны для безопасной изоляции программ. Одно из применений — сборка мусора. [Не существует тривиального способа](https://www.lua.org/pil/24.2.html) реализовать автоматическую сборку мусора поверх C или C++, так как программа не может видеть собственный стек или переменные. Однако VM находится «вне» запущенной программы и может наблюдать все [ссылки на ячейки памяти](https://en.wikipedia.org/wiki/Tracing_garbage_collection) в стеке.

Ещё один пример такого поведения демонстрируют [смарт-контракты Ethereum](https://solidity.readthedocs.io/en/v0.4.24/introduction-to-smart-contracts.html). Смарт-контракты — это небольшие программы, которые выполняются каждым узлом валидации в блокчейне. То есть операторы разрешают выполнение на своих машинах любых программ, написанных совершенно незнакомыми людьми, без какой-либо возможности изучить их заранее. Чтобы предотвратить вредоносные действия, они выполняются на [VM](http://ethdocs.org/en/latest/introduction/what-is-ethereum.html#ethereum-virtual-machine), не имеющей доступа к файловой системе, сети, диску и т.д. Ethereum — также хороший пример переносимости. Благодаря VM можно писать смарт-контракты без учёта особенностей множества платформ.

## 3\. Архитектура LC-3

![](data:image/png;base64,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)

Наша VM будет симулировать вымышленный компьютер под названием [LC-3](https://en.wikipedia.org/wiki/LC-3). Он популярен для обучения студентов ассемблеру. Здесь упрощённый набор команд [по сравнению с x86](http://ref.x86asm.net/coder64.html), но сохраняются все основные концепции, которые используются в современных CPU.

Во-первых, нужно сымитировать необходимые аппаратные компоненты. Попытайтесь понять, что представляет собой каждый компонент, но не волнуйтесь, если не уверены, как он вписывается в общую картину. Начнём с создания файла на С. Каждый фрагмент кода из этого раздела следует поместить в глобальную область видимости этого файла.

### Память

В компьютере LC-3 есть 65 536 ячеек памяти (2<sup>16</sup>), каждая из которых содержит 16-разрядное значение. Это означает, что он может хранить всего 128 Кб — намного меньше, чем вы привыкли! В нашей программе эта память хранится в простом массиве:

```
/* 65536 locations */
uint16_t memory[UINT16_MAX];
```

  

### Регистры

Регистр — это слот для хранения одного значения в CPU. Регистры подобны «верстаку» CPU. Чтобы он мог работать с каким-то фрагментом данных, тот должен находиться в одном из регистров. Но поскольку регистров всего несколько, в любой момент времени можно загрузить только минимальный объём данных. Программы обходят эту проблему, загружая значения из памяти в регистры, вычисляя значения в другие регистры, а затем сохраняя окончательные результаты обратно в память.

В компьютере LC-3 всего 10 регистров, каждый на 16 бит. Большинство из них —общего назначения, но некоторым назначены роли.

-   8 регистров общего назначения (`R0-R7`)
-   1 регистр счётчика команд (`PC`)
-   1 регистр флагов условий (`COND`)

Регистры общего назначения могут использоваться для выполнения любых программных вычислений. Счётчик команд представляет собой целое число без знака, которое является адресом в памяти следующей инструкции для выполнения. Флаги условий сообщают нам информацию о предыдущем вычислении.

```
enum
{
    R_R0 = 0,
    R_R1,
    R_R2,
    R_R3,
    R_R4,
    R_R5,
    R_R6,
    R_R7,
    R_PC, /* program counter */
    R_COND,
    R_COUNT
};
```

Как и память, будем хранить регистры в массиве:

```
uint16_t reg[R_COUNT];
```

  

### Набор инструкций

Инструкция — это команда, которая говорит процессору выполнить какую-то фундаментальную задачу, например, сложить два числа. У инструкции есть **опкод** (код операции), указывающий тип выполняемой задачи, а также набор **параметров**, которые предоставляют входные данные для выполняемой задачи.

Каждый **опкод** представляет собой одну задачу, которую процессор «знает», как выполнить. В LC-3 всего 16 опкодов. Компьютер может вычислить только последовательность этих простых инструкций. Длина каждой инструкции 16 бит, а левые 4 бита хранят код операции. Остальные используются для хранения параметров.

Позже подробно обсудим, что делает каждая инструкция. На данный момент определите следующие опкоды. Удостоверьтесь, что сохраняют такой порядок, чтобы получать правильное значение enum:

```
enum
{
    OP_BR = 0, /* branch */
    OP_ADD,    /* add  */
    OP_LD,     /* load */
    OP_ST,     /* store */
    OP_JSR,    /* jump register */
    OP_AND,    /* bitwise and */
    OP_LDR,    /* load register */
    OP_STR,    /* store register */
    OP_RTI,    /* unused */
    OP_NOT,    /* bitwise not */
    OP_LDI,    /* load indirect */
    OP_STI,    /* store indirect */
    OP_JMP,    /* jump */
    OP_RES,    /* reserved (unused) */
    OP_LEA,    /* load effective address */
    OP_TRAP    /* execute trap */
};
```

  

> **Примечание:** в архитектуре Intel x86 сотни инструкций, в то время как в других архитектурах, таких как ARM и LC-3, очень мало. Небольшие наборы инструкций называются [RISC](https://en.wikipedia.org/wiki/Reduced_instruction_set_computer), а более крупные — [CISC](https://en.wikipedia.org/wiki/Complex_instruction_set_computer). Большие наборы инструкций, как правило, не предоставляют принципиально новых возможностей, но [часто упрощают написание ассемблерного кода](https://cs.stanford.edu/people/eroberts/courses/soco/projects/risc/risccisc/). Одна инструкция CISC может заменить несколько инструкций RISC. Однако процессоры CISC более сложны и дороги в проектировании и производстве. Это и другие компромиссы [не позволяют назвать «оптимальный» дизайн](https://cs.stackexchange.com/questions/269/why-would-anyone-want-cisc).

  

### Флаги условий

Регистр `R_COND` хранит флаги условий, которые предоставляют информацию о последнем выполненном вычислении. Это позволяет программам проверять логические условия, такие как `if (x > 0) { ... }`.

У каждого процессора множество флагов состояния для сигнализации о различных ситуациях. LC-3 использует только три флага условий, которые показывают знак предыдущего вычисления.

```
enum
{
    FL_POS = 1 << 0, /* P */
    FL_ZRO = 1 << 1, /* Z */
    FL_NEG = 1 << 2, /* N */
};
```

  

> **Примечание:** (Символ `<<` называется [оператором левого сдвига](https://msdn.microsoft.com/en-us/library/336xbhcz.aspx). `(n << k)` сдвигает биты `n` влево на `k` мест. Таким образом, `1 << 2` равняется `4`. Почитайте [здесь](https://msdn.microsoft.com/en-us/library/336xbhcz.aspx), если не знакомы с концепцией. Это будет очень важно).

Мы закончили настройку аппаратных компонентов нашей виртуальной машины! После добавления стандартных включений (см. по ссылке выше) ваш файл должен выглядеть примерно так:

```
{Includes, 12}

{Registers, 3}
{Opcodes, 3}
{Condition Flags, 3}
```

Здесь указаны ссылки на пронумерованные разделы статьи, откуда берутся соответствующие фрагменты кода. Полный листинг см. в [рабочей программе](https://justinmeiners.github.io/lc3-vm/index.html) — прим. пер.

## 4\. Примеры на ассемблере

Теперь рассмотрим программу на ассемблере LC-3, чтобы получить представление, что фактически выполняет виртуальная машина. Вам не нужно знать, как программировать на ассемблере, или всё тут понимать. Просто постарайтесь получить общее представление, что происходит. Вот простой «Hello World»:

```
.ORIG x3000                        ; this is the address in memory where the program will be loaded
LEA R0, HELLO_STR                  ; load the address of the HELLO_STR string into R0
PUTs                               ; output the string pointed to by R0 to the console
HALT                               ; halt the program
HELLO_STR .STRINGZ "Hello World!"  ; store this string here in the program
.END                               ; mark the end of the file
```

Как и в C, программа выполняет по одному оператору сверху вниз. Но в отличие от C, здесь нет вложенных областей `{}` или управляющих структур, таких как `if` или `while`; только простой список операторов. Поэтому его гораздо легче выполнить.

Обратите внимание, что имена некоторых операторов соответствуют опкодам, которые мы определили ранее. Мы знаем, что в инструкциях по 16 бит, но каждая строка выглядит как будто с разным количеством символов. Как возможно такое несоответствие?

Это происходит потому что код, который мы читаем, написан на **ассемблере** — в удобочитаемой и доступной для записи форме обычным текстом. Инструмент, называемый **ассемблером**, преобразует каждую строку текста в 16-разрядную двоичную инструкцию, понятную виртуальной машине. Эта двоичная форма, которая по сути представляет собой массив 16-разрядных инструкций, называется **машинным кодом** и фактически выполняется виртуальной машиной.

![](data:image/gif;base64,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)

  

> **Примечание:** хотя компилятор и ассемблер играют схожую роль в разработке, они не одинаковы. Ассемблер просто кодирует то, что программист написал в тексте, заменяя символы их двоичным представлением и упаковывая их в инструкции.

Команды `.ORIG` и `.STRINGZ` выглядят как инструкции, но нет. Это директивы ассемблера, которые генерируют часть кода или данных. Например, `.STRINGZ` вставляет строку символов в указанном месте двоичной программы.

Циклы и условия выполняются с помощью goto-подобной инструкции. Вот еще один пример, который считает до 10.

```
AND R0, R0, 0                      ; clear R0
LOOP                               ; label at the top of our loop
ADD R0, R0, 1                      ; add 1 to R0 and store back in R0
ADD R1, R0, -10                    ; subtract 10 from R0 and store back in R1
BRn LOOP                           ; go back to LOOP if the result was negative
... ; R0 is now 10!
```

  

> **Примечание:** для этого руководства необязательно учиться ассемблеру. Но если вам интересно, можете написать и собрать собственные программы LC-3 с помощью [LC-3 Tools](http://highered.mheducation.com/sites/0072467509/student_view0/lc-3_simulator.html).

  

## 5\. Выполнение программ

Ещё раз, предыдущие примеры просто дают представление, что делает VM. Для написания VM вам не нужно полное понимание ассемблера. Пока вы следуете соответствующей процедуре чтения и исполнения инструкций, _любая_ программа LC-3 будет корректно работать, независимо от её сложности. В теории, VM может запустить даже браузер или операционную систему, как Linux!

Если глубоко задуматься, то это философски замечательная идея. Сами программы могут производить сколь угодно сложные действия, которые мы никогда не ожидали и, возможно, не сможем понять. Но в то же время вся их функциональность ограничивается простым кодом, который мы напишем! Мы одновременно знаем всё и ничего о том, как работает каждая программа. Тьюринг упоминал эту чудесную идею:

> «Мнение о том, что машины не могут чем-либо удивить человека, основывается, как я полагаю, на одном заблуждении, которому в особенности подвержены математики и философы. Я имею в виду предположение о том, что коль скоро какой-то факт стал достоянием разума, тотчас же достоянием разума становятся все следствия из этого факта». — [Алан М. Тьюринг](https://academic.oup.com/mind/article-pdf/LIX/236/433/9866119/433.pdf)

  

### Процедура

Вот точное описание процедуры, которую нужно написать:

1.  Загрузить одну инструкцию из памяти по адресу регистра `PC`.
2.  Увеличить регистр `PC`.
3.  Посмотреть опкод, чтобы определить, какой тип инструкции выполнять.
4.  Выполнить инструкцию, используя её параметры.
5.  Вернуться к шагу 1.

Вы можете задать вопрос: «Но если цикл продолжает увеличивать счётчик в отсутствие `if` или `while`, инструкции разве не закончатся?» Ответ отрицательный. Как мы уже упоминали, некоторые goto-подобные инструкции изменяют поток выполнения, прыгая вокруг `PC`.

Начнём изучение этого процесса на примере основного цикла:

```
int main(int argc, const char* argv[])
{
    {Load Arguments, 12}
    {Setup, 12}

    /* set the PC to starting position */
    /* 0x3000 is the default */
    enum { PC_START = 0x3000 };
    reg[R_PC] = PC_START;

    int running = 1;
    while (running)
    {
        /* FETCH */
        uint16_t instr = mem_read(reg[R_PC]++);
        uint16_t op = instr >> 12;

        switch (op)
        {
            case OP_ADD:
                {ADD, 6}
                break;
            case OP_AND:
                {AND, 7}
                break;
            case OP_NOT:
                {NOT, 7}
                break;
            case OP_BR:
                {BR, 7}
                break;
            case OP_JMP:
                {JMP, 7}
                break;
            case OP_JSR:
                {JSR, 7}
                break;
            case OP_LD:
                {LD, 7}
                break;
            case OP_LDI:
                {LDI, 6}
                break;
            case OP_LDR:
                {LDR, 7}
                break;
            case OP_LEA:
                {LEA, 7}
                break;
            case OP_ST:
                {ST, 7}
                break;
            case OP_STI:
                {STI, 7}
                break;
            case OP_STR:
                {STR, 7}
                break;
            case OP_TRAP:
                {TRAP, 8}
                break;
            case OP_RES:
            case OP_RTI:
            default:
                {BAD OPCODE, 7}
                break;
        }
    }
    {Shutdown, 12}
}
```

  

## 6\. Реализация инструкций

Теперь ваша задача — сделать правильную реализацию для каждого опкода. Подробная спецификация каждой инструкции содержится в [документации проекта](https://justinmeiners.github.io/lc3-vm/supplies/lc3-isa.pdf). Из спецификации нужно узнать, как работает каждая инструкция, и написать реализацию. Это проще, чем кажется. Здесь я продемонстрирую, как реализовать две из них. Код для остальных можно найти в следующем разделе.

### ADD

Инструкция `ADD` берёт два числа, складывает их и сохраняет результат в регистре. Спецификация в документации на стр. 526. Каждая инструкция `ADD` выглядит следующим образом:

![](data:image/gif;base64,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)

На схеме две строки, потому что для этой инструкции есть два различных «режима». Прежде чем я объясню режимы, давайте попробуем найти сходство между ними. Обе они начинаются с четырёх одинаковых битов `0001`. Это значение опкода для `OP_ADD`. Следующие три бита помечены `DR` для выходного регистра. Выходной регистр — это место хранения суммы. Следующие три бита: `SR1`. Это регистр, содержащий первое добавляемое число.

Таким образом, мы знаем, где сохранить результат, и знаем первое число для сложения. Осталось только узнать второе число для сложения. Здесь две строки начинают различаться. Обратите внимание, что вверху 5-й бит равен 0, а внизу — 1. Этот бит соответствует или _непосредственному режиму_, или _регистровому режиму_. В регистровом режиме второе число хранится в регистре, как и первое. Оно отмечено как `SR2` и содержится в битах со второго по нулевой. Биты 3 и 4 не используются. На ассемблере это будет написано так:

```
ADD R2 R0 R1 ; add the contents of R0 to R1 and store in R2.
```

В непосредственном режиме вместо добавления содержимого регистра непосредственное значение внедряется в саму инструкцию. Это удобно, потому что программе не нужны дополнительные инструкции для загрузки этого числа в регистр из памяти. Вместо этого оно уже внутри инструкции, когда нам нужно. Компромисс в том, что там могут храниться только небольшие числа. Если быть точным, максимум 2<sup>5</sup>\=32. Это наиболее полезно для увеличения счётчиков или значений. На ассемблере можно написать так:

```
ADD R0 R0 1 ; add 1 to R0 and store back in R0
```

Вот выдержка из спецификации:

> Если бит \[5\] равен 0, то второй исходный операнд получают из SR2. Если бит \[5\] равен 1, то второй исходный операнд получают путём расширения значения imm5 до 16 бит. В обоих случаях второй исходный операнд добавляется к содержимому SR1, а результат сохраняется в DR. (стр. 526)

Это похоже на то, что мы обсуждали. Но что такое «расширение значения»? Хотя в непосредственном режиме у значения только 5 бит, его нужно сложить с 16-разрядным числом. Эти 5 бит следует расширить до 16, чтобы соответствовать другому числу. Для положительных чисел мы можем заполнить недостающие биты нулями и получить такое же значение. Однако для отрицательных чисел это не работает. Например, −1 в пяти битах равно `1 1111`. Если просто заполнить нулями, получим `0000 0000 0001 1111`, что равно 32! Расширение значения предотвращает эту проблему, заполняя биты нулями для положительных чисел и единицами для отрицательных чисел.

```
uint16_t sign_extend(uint16_t x, int bit_count)
{
    if ((x >> (bit_count - 1)) & 1) {
        x |= (0xFFFF << bit_count);
    }
    return x;
}
```

  

> **Примечание:** если вас интересуют двоичные отрицательные числа, можете прочитать о [дополнительном коде](https://en.wikipedia.org/wiki/Two%27s_complement). Но это не существенно. Достаточно просто скопировать код выше и использовать его, когда спецификация говорит расширить значение.

В спецификации есть последнее предложение:

> Коды условий задаются в зависимости от того, является ли результат отрицательным, нулевым или положительным. (стр. 526)

Ранее мы определили условие flags enum, а теперь пришло время использовать этих флаги. Каждый раз, когда значение записывается в регистр, нам нужно обновить флаги, чтобы указать его знак. Напишем функцию для повторного использования:

```
void update_flags(uint16_t r)
{
    if (reg[r] == 0)
    {
        reg[R_COND] = FL_ZRO;
    }
    else if (reg[r] >> 15) /* a 1 in the left-most bit indicates negative */
    {
        reg[R_COND] = FL_NEG;
    }
    else
    {
        reg[R_COND] = FL_POS;
    }
}
```

Теперь мы готовы написать код для `ADD`:

```
{
    /* destination register (DR) */
    uint16_t r0 = (instr >> 9) & 0x7;
    /* first operand (SR1) */
    uint16_t r1 = (instr >> 6) & 0x7;
    /* whether we are in immediate mode */
    uint16_t imm_flag = (instr >> 5) & 0x1;

    if (imm_flag)
    {
        uint16_t imm5 = sign_extend(instr & 0x1F, 5);
        reg[r0] = reg[r1] + imm5;
    }
    else
    {
        uint16_t r2 = instr & 0x7;
        reg[r0] = reg[r1] + reg[r2];
    }

    update_flags(r0);
}
```

В этом разделе много информации, поэтому подведём итоги.

-   `ADD` берёт два значения и сохраняет их в регистре.
-   В регистровом режиме второе добавляемое значение находится в регистре.
-   В непосредственном режиме второе значение внедряется в правые 5 бит инструкции.
-   Значения короче 16 бит следует расширить.
-   Каждый раз, когда инструкция изменяет регистр, следует обновить флаги условий.

Вы можете быть ошеломлены написанием ещё 15 инструкций. Однако полученную здесь информацию можно использовать повторно. В большинстве инструкций используется комбинация расширения значения, различных режимов и обновления флагов.

### LDI

LDI означает «косвенную» или «непрямую» загрузку (load indirect). Эта инструкция используется для загрузки в регистр значения из места в памяти. Спецификация на стр. 532.

Вот как выглядит двоичная компоновка:

![](data:image/gif;base64,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)

В отличие от `ADD`, здесь нет режимов и меньше параметров. На этот раз код операции `1010`, что соответствует значению enum `OP_LDI`. Опять же мы видим трёхбитный `DR` (выходной регистр) для хранения загруженного значения. Остальные биты помечены как `PCoffset9`. Это непосредственное значение, встроенное в инструкцию (аналогично `imm5`). Поскольку инструкция загружается из памяти, мы можем догадаться, что это число является своего рода адресом, который говорит, откуда загружать значение. Спецификация объясняет подробнее:

> Адрес вычисляется с помощью расширения битов значения `[8:0]` до 16 бит и добавления этого значения к увеличенному `PC`. Что хранится в памяти по этому адресу — это адрес данных, которые будут загружены в `DR`. (стр. 532)

Как и раньше, нужно расширить это 9-битное значение, но на этот раз добавить его к текущему `PC`. (Если вы посмотрите на цикл выполнения, `PC` увеличился сразу после загрузки этой инструкции). Результирующая сумма — это адрес местоположения в памяти, и этот адрес _содержит ещё одно_ значение, которое является адресом загружаемого значения.

Это может показаться окольным путём для чтения из памяти, но так нужно. Инструкция `LD` ограничена адресным смещением 9 бит, тогда как память требует для адреса 16 бит. `LDI` полезна для загрузки значений, которые хранятся где-то за пределами текущего компьютера, но для их использования адрес конечного местоположения должен храниться рядом. Вы можете думать о ней как о локальной переменной в C, которая является указателем на некоторые данные:

```
// the value of far_data is an address
// of course far_data itself (the location in memory containing the address) has an address
char* far_data = "apple";

// In memory it may be layed out like this:

// Address Label      Value
// 0x123:  far_data = 0x456
// ...
// 0x456:  string   = 'a'

// if PC was at 0x100
// LDI R0 0x023
// would load 'a' into R0
```

Как и раньше, после записи значения в `DR` следует обновить флаги:

> Коды условий задаются в зависимости от того, является ли результат отрицательным, нулевым или положительным. (стр. 532)

Вот код для данного случая: (`mem_read` обсудим в следующем разделе):

```
{
    /* destination register (DR) */
    uint16_t r0 = (instr >> 9) & 0x7;
    /* PCoffset 9*/
    uint16_t pc_offset = sign_extend(instr & 0x1ff, 9);
    /* add pc_offset to the current PC, look at that memory location to get the final address */
    reg[r0] = mem_read(mem_read(reg[R_PC] + pc_offset));
    update_flags(r0);
}
```

Как я уже сказал, для этой инструкции мы использовали значительную часть кода и знаний, полученных ранее при написании `ADD`. То же самое с остальными инструкциями.

Теперь необходимо реализовать остальные инструкции. Следуйте [спецификации](https://justinmeiners.github.io/lc3-vm/supplies/lc3-isa.pdf) и используйте уже написанный код. Код для всех инструкций приведён в конце статьи. Два из перечисленных ранее опкодов нам не понадобятся: это `OP_RTI` и `OP_RES`. Можно их проигнорировать или выдать ошибку, если они вызываются. Когда закончите, основную часть вашей VM можно считать завершённой!

## 7\. Шпаргалка по инструкциям

В этом разделе — полные реализации оставшихся инструкций, если вы застряли.

### RTI & RES

(не используются)

```
abort();
```

  

### [Битовое «И»](https://en.wikipedia.org/wiki/Bitwise_operation#AND)

  

```
{
    uint16_t r0 = (instr >> 9) & 0x7;
    uint16_t r1 = (instr >> 6) & 0x7;
    uint16_t imm_flag = (instr >> 5) & 0x1;

    if (imm_flag)
    {
        uint16_t imm5 = sign_extend(instr & 0x1F, 5);
        reg[r0] = reg[r1] & imm5;
    }
    else
    {
        uint16_t r2 = instr & 0x7;
        reg[r0] = reg[r1] & reg[r2];
    }
    update_flags(r0);
}
```

  

### [Битовое «НЕ»](https://en.wikipedia.org/wiki/Bitwise_operation#NOT)

  

```
{
    uint16_t r0 = (instr >> 9) & 0x7;
    uint16_t r1 = (instr >> 6) & 0x7;

    reg[r0] = ~reg[r1];
    update_flags(r0);
}
```

  

### Branch

  

```
{
    uint16_t pc_offset = sign_extend((instr) & 0x1ff, 9);
    uint16_t cond_flag = (instr >> 9) & 0x7;
    if (cond_flag & reg[R_COND])
    {
        reg[R_PC] += pc_offset;
    }
}
```

  

### Jump

`RET` указана как отдельная инструкция в спецификации, так как это другая команда в ассемблере. На самом деле это особый случай `JMP`. `RET` происходит всякий раз, когда `R1` равно 7.

```
{
    /* Also handles RET */
    uint16_t r1 = (instr >> 6) & 0x7;
    reg[R_PC] = reg[r1];
}
```

  

### Jump Register

  

```
{
    uint16_t r1 = (instr >> 6) & 0x7;
    uint16_t long_pc_offset = sign_extend(instr & 0x7ff, 11);
    uint16_t long_flag = (instr >> 11) & 1;

    reg[R_R7] = reg[R_PC];
    if (long_flag)
    {
        reg[R_PC] += long_pc_offset;  /* JSR */
    }
    else
    {
        reg[R_PC] = reg[r1]; /* JSRR */
    }
    break;
}
```

  

### Load

  

```
{
    uint16_t r0 = (instr >> 9) & 0x7;
    uint16_t pc_offset = sign_extend(instr & 0x1ff, 9);
    reg[r0] = mem_read(reg[R_PC] + pc_offset);
    update_flags(r0);
}
```

  

### Load Register

  

```
{
    uint16_t r0 = (instr >> 9) & 0x7;
    uint16_t r1 = (instr >> 6) & 0x7;
    uint16_t offset = sign_extend(instr & 0x3F, 6);
    reg[r0] = mem_read(reg[r1] + offset);
    update_flags(r0);
}
```

  

### Эффективный адрес Load

  

```
{
    uint16_t r0 = (instr >> 9) & 0x7;
    uint16_t pc_offset = sign_extend(instr & 0x1ff, 9);
    reg[r0] = reg[R_PC] + pc_offset;
    update_flags(r0);
}
```

  

### Store

  

```
{
    uint16_t r0 = (instr >> 9) & 0x7;
    uint16_t pc_offset = sign_extend(instr & 0x1ff, 9);
    mem_write(reg[R_PC] + pc_offset, reg[r0]);
}
```

  

### Store Indirect

  

```
{
    uint16_t r0 = (instr >> 9) & 0x7;
    uint16_t pc_offset = sign_extend(instr & 0x1ff, 9);
    mem_write(mem_read(reg[R_PC] + pc_offset), reg[r0]);
}
```

  

### Store Register

  

```
{
    uint16_t r0 = (instr >> 9) & 0x7;
    uint16_t r1 = (instr >> 6) & 0x7;
    uint16_t offset = sign_extend(instr & 0x3F, 6);
    mem_write(reg[r1] + offset, reg[r0]);
}
```

  

## 8\. Процедуры обработки прерываний

LC-3 обеспечивает несколько предопределённых подпрограмм для выполнения общих задач и взаимодействия с устройствами ввода-вывода. Например, есть процедуры для получения ввода с клавиатуры и вывода строк на консоль. Они называются _программами обработки системных прерываний_ (trap routines), которые вы можете представлять как операционную систему или API для LC-3. Каждой подпрограмме присваивается код прерывания (trap-код), который её идентифицирует (аналогично опкоду). Для её выполнения вызывается инструкция `TRAP` с кодом нужной подпрограммы.

![](data:image/gif;base64,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)

Установим enum для каждого кода прерывания:

```
enum
{
    TRAP_GETC = 0x20,  /* get character from keyboard */
    TRAP_OUT = 0x21,   /* output a character */
    TRAP_PUTS = 0x22,  /* output a word string */
    TRAP_IN = 0x23,    /* input a string */
    TRAP_PUTSP = 0x24, /* output a byte string */
    TRAP_HALT = 0x25   /* halt the program */
};
```

Вам может быть интересно, почему коды прерываний не включены в инструкции. Это потому что они фактически не добавляют LC-3 никакой новой функциональности, а только обеспечивают удобный способ выполнения задачи (подобно системным функциям в C). В официальном симуляторе LC-3 коды прерываний [написаны на ассемблере](https://justinmeiners.github.io/lc3-vm/supplies/os.asm). При вызове кода прерывания компьютер перемещается по адресу этого кода. CPU выполняет инструкции процедуры, а по завершении `PC` сбрасывается в местоположение, откуда было вызвано прерывание.

> **Примечание:** вот почему программы начинаются с адреса `0x3000` вместо `0x0`. Нижние адреса остаются пустыми, чтобы оставить место для кода подпрограммы обработки прерываний.

Нет никакой спецификации, _как_ реализовать подпрограммы обработки прерываний: только то, что они должны делать. В нашей VM мы поступим немного иначе, написав их на C. При вызове кода прерывания будет вызвана функция C. После её работы продолжится выполнение инструкции.

Хотя процедуры можно написать на ассемблере и в физическом компьютере LC-3 так и будет, это не лучший вариант для VM. Вместо написания собственных примитивных процедур ввода-вывода можно воспользоваться теми, которые доступны на нашей ОС. Это улучшит работу виртуальной машины на наших компьютерах, упростит код и обеспечит более высокий уровень абстракции для переносимости.

> **Примечание:** одним из конкретных примеров является ввод с клавиатуры. В ассемблерной версии используется цикл для непрерывной проверки ввода клавиатуры. Но ведь так впустую тратится много процессорного времени! При использовании надлежащей функции ОС программа может спокойно спать до входного сигнала.

В оператор множественного выбора для опкода `TRAP` добавим ещё один switch:

```
switch (instr & 0xFF)
{
    case TRAP_GETC:
        {TRAP GETC, 9}
        break;
    case TRAP_OUT:
        {TRAP OUT, 9}
        break;
    case TRAP_PUTS:
        {TRAP PUTS, 8}
        break;
    case TRAP_IN:
        {TRAP IN, 9}
        break;
    case TRAP_PUTSP:
        {TRAP PUTSP, 9}
        break;
    case TRAP_HALT:
        {TRAP HALT, 9}
        break;
}
```

Как и в случае с инструкциями, я покажу, как реализовать одну процедуру, а остальное сделаете сами.

### PUTS

Код прерывания `PUTS` используется для выдачи строки с завершающим нулём (аналогично `printf` в C). Спецификация на стр. 543.

Чтобы отобразить строку, мы должны дать подпрограмме обработки прерываний строку для отображения. Это делается путём сохранения адреса первого символа в `R0` перед началом обработки.

Из спецификации:

> Выведите строку символов ASCII на дисплей консоли. Символы содержатся в последовательных ячейках памяти, по одному символу на ячейку, начиная с адреса, указанного в `R0`. Вывод завершается, когда в памяти встречается значение `x0000`. (стр. 543)

Обратите внимание, что в отличие от строк C, здесь символы хранятся _не в одном байте, а по одному расположению в памяти_. Расположение в памяти LC-3 составляет 16 бит, поэтому у каждого символа в строке размер 16 бит. Чтобы отобразить это в функции C, нужно преобразовать каждое значение в символ и вывести их по отдельности.

```
{
    /* one char per word */
    uint16_t* c = memory + reg[R_R0];
    while (*c)
    {
        putc((char)*c, stdout);
        ++c;
    }
    fflush(stdout);
}
```

Для данной процедуры больше ничего не требуется. Подпрограммы обработки прерываний довольно просты, если вы знаете C. Теперь вернитесь к спецификации и реализуйте остальные. Как и в случае с инструкциями, полный код можно найти в конце этого руководства.

## 9\. Шпаргалка по процедурам обработки прерываний

Этот раздел содержит полные реализации остальных подпрограмм обработки прерываний.

### Ввод символа

  

```
/* read a single ASCII char */
reg[R_R0] = (uint16_t)getchar();
```

  

### Вывод символа

  

```
putc((char)reg[R_R0], stdout);
fflush(stdout);
```

  

### Запрос ввода символа

  

```
printf("Enter a character: ");
reg[R_R0] = (uint16_t)getchar();
```

  

### Вывод строки

  

```
{
    /* one char per byte (two bytes per word)
       here we need to swap back to
       big endian format */
    uint16_t* c = memory + reg[R_R0];
    while (*c)
    {
        char char1 = (*c) & 0xFF;
        putc(char1, stdout);
        char char2 = (*c) >> 8;
        if (char2) putc(char2, stdout);
        ++c;
    }
    fflush(stdout);
}
```

  

### Прекращение выполнения программы

  

```
puts("HALT");
fflush(stdout);
running = 0;
```

  

## 10\. Загрузка программ

Мы много говорили о загрузке и выполнении инструкций из памяти, но как вообще инструкции попадают в память? При преобразовании ассемблерной программы в машинный код результатом является файл, содержащий массив инструкций и данных. Его можно загрузить, просто скопировав содержимое прямо в адрес в памяти.

Первые 16 бит файла программы указывают адрес в памяти, где следует начать выполнение программы. Этот адрес называется **origin**. Он должен быть прочитан первым, после чего в память из файла считываются остальные данные.

Вот код для загрузки программы в память LC-3:

```
void read_image_file(FILE* file)
{
    /* the origin tells us where in memory to place the image */
    uint16_t origin;
    fread(&origin, sizeof(origin), 1, file);
    origin = swap16(origin);

    /* we know the maximum file size so we only need one fread */
    uint16_t max_read = UINT16_MAX - origin;
    uint16_t* p = memory + origin;
    size_t read = fread(p, sizeof(uint16_t), max_read, file);

    /* swap to little endian */
    while (read-- > 0)
    {
        *p = swap16(*p);
        ++p;
    }
}
```

Обратите внимание, что для каждого загруженного значения вызывается `swap16`. Программы LC-3 записаны в прямом порядке байтов, но большинство современных компьютеров используют обратный порядок. В результате нам нужно перевернуть каждый загруженный `uint16`. (Если вы случайно используете [странный компьютер](https://en.wikipedia.org/wiki/Power_Mac_G4_Cube) вроде [PPC](https://en.wikipedia.org/wiki/PowerPC#Endian_modes), то ничего менять не надо).

```
uint16_t swap16(uint16_t x)
{
    return (x << 8) | (x >> 8);
}
```

  

> **Примечание:** [Порядок байтов](https://en.wikipedia.org/wiki/Endianness) относится к тому, как интерпретируются байты целого числа. В обратном порядке первый байт является наименьшей значащей цифрой, а в прямом порядке — наоборот. Насколько мне известно, решение _в основном_ произвольное. Разные компании принимали разные решения, так что теперь у нас различные реализации. Для этого проекта больше ничего не нужно знать о порядке байтов.

Добавим также удобную функцию для `read_image_file`, которая принимает путь для строки:

```
int read_image(const char* image_path)
{
    FILE* file = fopen(image_path, "rb");
    if (!file) { return 0; };
    read_image_file(file);
    fclose(file);
    return 1;
}
```

  

## 11\. Отображаемые в памяти регистры

Некоторые специальные регистры недоступны из обычной таблицы регистров. Вместо этого для них в памяти зарезервирован специальный адрес. Чтобы читать и писать в эти регистры, вы просто читаете и записываете в их память. Они называются **отображаемыми в памяти регистрами**. Обычно они используются для взаимодействия со специальными аппаратными устройствами.

Для нашей LC-3 нужно реализовать два отображаемых в памяти регистра. Это регистр состояния клавиатуры (`KBSR`) и регистр данных клавиатуры (`KBDR`). Первый указывает, была ли нажата клавиша, а второй определяет, какая именно клавиша нажата.

Хотя ввод с клавиатуры можно запросить с помощью `GETC`, это блокирует выполнение до получения ввода. `KBSR` и `KBDR` позволяют [опрашивать состояние](https://en.wikipedia.org/wiki/Polling_(computer_science)) устройства, продолжая выполнение программы, так что она остаётся отзывчивой во время ожидания ввода.

```
enum
{
    MR_KBSR = 0xFE00, /* keyboard status */
    MR_KBDR = 0xFE02  /* keyboard data */
};
```

Отображаемые в памяти регистры немного усложняют доступ к памяти. Мы не можем читать и записывать в массив памяти напрямую, а вместо этого должны вызывать специальные функции — сеттер и геттер. После чтения памяти из регистра KBSR геттер проверит клавиатуру и обновляет оба местоположения в памяти.

```
void mem_write(uint16_t address, uint16_t val)
{
    memory[address] = val;
}

uint16_t mem_read(uint16_t address)
{
    if (address == MR_KBSR)
    {
        if (check_key())
        {
            memory[MR_KBSR] = (1 << 15);
            memory[MR_KBDR] = getchar();
        }
        else
        {
            memory[MR_KBSR] = 0;
        }
    }
    return memory[address];
}
```

Это последний компонент виртуальной машины! Если вы реализовали остальные процедуры обработки прерываний и инструкции, то почти готовы попробовать её!

Всё написанное следует добавить в файл C в следующем порядке:

```
{Memory Mapped Registers, 11}
{TRAP Codes, 8}

{Memory Storage, 3}
{Register Storage, 3}

{Functions, 12}

{Main Loop, 5}
```

  

## 12\. Особенности платформы

Этот раздел содержит некоторые утомительные детали, необходимые для доступа к клавиатуре и корректной работы. Здесь ничего интересного или познавательного о работе виртуальных машин. Не стесняйтесь копипаста!

Если пытаетесь запустить VM в операционной системе, отличной от Unix, например Windows, эти функции нужно заменить на соответствующие функции Windows.

```
uint16_t check_key()
{
    fd_set readfds;
    FD_ZERO(&readfds);
    FD_SET(STDIN_FILENO, &readfds);

    struct timeval timeout;
    timeout.tv_sec = 0;
    timeout.tv_usec = 0;
    return select(1, &readfds, NULL, NULL, &timeout) != 0;
}
```

Код для извлечения пути из аргументов программы и вывода примера использования, если они отсутствуют.

```
if (argc < 2)
{
    /* show usage string */
    printf("lc3 [image-file1] ...\n");
    exit(2);
}

for (int j = 1; j < argc; ++j)
{
    if (!read_image(argv[j]))
    {
        printf("failed to load image: %s\n", argv[j]);
        exit(1);
    }
}
```

Специфичный для Unix код настройки ввода с терминала.

```
struct termios original_tio;

void disable_input_buffering()
{
    tcgetattr(STDIN_FILENO, &original_tio);
    struct termios new_tio = original_tio;
    new_tio.c_lflag &= ~ICANON & ~ECHO;
    tcsetattr(STDIN_FILENO, TCSANOW, &new_tio);
}

void restore_input_buffering()
{
    tcsetattr(STDIN_FILENO, TCSANOW, &original_tio);
}
```

Когда программа прерывается, мы хотим вернуть нормальные настройки консоли.

```
void handle_interrupt(int signal)
{
    restore_input_buffering();
    printf("\n");
    exit(-2);
}
```

  

```
signal(SIGINT, handle_interrupt);
disable_input_buffering();
```

  

```
restore_input_buffering();
```

  

```
{Sign Extend, 6}
{Swap, 10}
{Update Flags, 6}
{Read Image File, 10}
{Read Image, 10}
{Check Key, 12}
{Memory Access, 11}
{Input Buffering, 12}
{Handle Interrupt, 12}
```

  

```
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <signal.h>
#include <unistd.h>
#include <fcntl.h>

#include <sys/time.h>
#include <sys/types.h>
#include <sys/termios.h>
#include <sys/mman.h>
```

  

## Запуск виртуальной машины

Теперь вы можете собрать и запустить виртуальную машину LC-3!

1.  Скомпилируйте [программу](https://justinmeiners.github.io/lc3-vm/src/lc3.c) любимым компилятором.
2.  Загрузите собранную версию [2048](https://justinmeiners.github.io/lc3-vm/supplies/2048.obj) или [Rogue](https://justinmeiners.github.io/lc3-vm/supplies/rogue.obj).
3.  Запустите программу с obj-файлом в качестве аргумента:  
    `lc3-vm path/to/2048.obj`
4.  Играйте в 2048!

  

```
Control the game using WASD keys.
Are you on an ANSI terminal (y/n)? y
+--------------------------+
|                          |
|                          |
|                          |
|                     2    |
|                          |
|   2                      |
|                          |
|                          |
|                          |
+--------------------------+
```

  

### Отладка

Если программа работает неправильно, скорее всего, вы неправильно закодировали какую-то инструкцию. Это может быть сложно отладить. Рекомендую одновременно читать ассемблерный код программы — и с помощью отладчика пошагово выполнять инструкции виртуальной машины по одной. При чтении кода убедитесь, что VM переходит к положенной инструкции. Если возникнет несоответствие, то вы узнаете, какая инструкция вызвала проблему. Перечитайте спецификацию и перепроверьте код.

## 14\. Альтернативный метод на C++

Здесь показан продвинутый способ выполнения инструкций, который значительно уменьшает размер кода. Это совершенно необязательный раздел.

Поскольку C++ поддерживает мощные дженерики в процессе компиляции, мы можем создавать части инструкций с помощью компилятора. Этот метод уменьшает дублирование кода и на самом деле ближе к аппаратному уровню работы компьютера.

Идея в том, чтобы повторно использовать шаги, общие для каждой инструкции. Например, некоторые инструкции используют косвенную адресацию или расширение значения и добавление его к текущему значению `PC`. Согласитесь, неплохо было бы написать этот код один раз для всех инструкций?

Рассматривая инструкцию как последовательность шагов, мы видим, что каждая инструкция — всего лишь перестановка нескольких меньших шагов. Будем использовать битовые флаги, чтобы отметить, какие шаги выполнять для каждой инструкции. Значение `1` в бите номера инструкции указывает, что для этой инструкции компилятор должен включить данный раздел кода.

```
template <unsigned op>
void ins(uint16_t instr)
{
    uint16_t r0, r1, r2, imm5, imm_flag;
    uint16_t pc_plus_off, base_plus_off;

    uint16_t opbit = (1 << op);
    if (0x4EEE & opbit) { r0 = (instr >> 9) & 0x7; }
    if (0x12E3 & opbit) { r1 = (instr >> 6) & 0x7; }
    if (0x0022 & opbit)
    {
        r2 = instr & 0x7;
        imm_flag = (instr >> 5) & 0x1;
        imm5 = sign_extend((instr) & 0x1F, 5);
    }
    if (0x00C0 & opbit)
    {   // Base + offset
        base_plus_off = reg[r1] + sign_extend(instr & 0x3f, 6);
    }
    if (0x4C0D & opbit)
    {
        // Indirect address
        pc_plus_off = reg[R_PC] + sign_extend(instr & 0x1ff, 9);
    }
    if (0x0001 & opbit)
    {
        // BR
        uint16_t cond = (instr >> 9) & 0x7;
        if (cond & reg[R_COND]) { reg[R_PC] = pc_plus_off; }
    }
    if (0x0002 & opbit)  // ADD
    {
        if (imm_flag)
        {
            reg[r0] = reg[r1] + imm5;
        }
        else
        {
            reg[r0] = reg[r1] + reg[r2];
        }
    }
    if (0x0020 & opbit)  // AND
    {
        if (imm_flag)
        {
            reg[r0] = reg[r1] & imm5;
        }
        else
        {
            reg[r0] = reg[r1] & reg[r2];
        }
    }
    if (0x0200 & opbit) { reg[r0] = ~reg[r1]; } // NOT
    if (0x1000 & opbit) { reg[R_PC] = reg[r1]; } // JMP
    if (0x0010 & opbit)  // JSR
    {
        uint16_t long_flag = (instr >> 11) & 1;
        pc_plus_off = reg[R_PC] +  sign_extend(instr & 0x7ff, 11);
        reg[R_R7] = reg[R_PC];
        if (long_flag)
        {
            reg[R_PC] = pc_plus_off;
        }
        else
        {
            reg[R_PC] = reg[r1];
        }
    }

    if (0x0004 & opbit) { reg[r0] = mem_read(pc_plus_off); } // LD
    if (0x0400 & opbit) { reg[r0] = mem_read(mem_read(pc_plus_off)); } // LDI
    if (0x0040 & opbit) { reg[r0] = mem_read(base_plus_off); }  // LDR
    if (0x4000 & opbit) { reg[r0] = pc_plus_off; } // LEA
    if (0x0008 & opbit) { mem_write(pc_plus_off, reg[r0]); } // ST
    if (0x0800 & opbit) { mem_write(mem_read(pc_plus_off), reg[r0]); } // STI
    if (0x0080 & opbit) { mem_write(base_plus_off, reg[r0]); } // STR
    if (0x8000 & opbit)  // TRAP
    {
         {TRAP, 8}
    }
    //if (0x0100 & opbit) { } // RTI
    if (0x4666 & opbit) { update_flags(r0); }
}
```

  

```
static void (*op_table[16])(uint16_t) = {
    ins<0>, ins<1>, ins<2>, ins<3>,
    ins<4>, ins<5>, ins<6>, ins<7>,
    NULL, ins<9>, ins<10>, ins<11>,
    ins<12>, NULL, ins<14>, ins<15>
};
```

**Примечание:** я узнал об этой технике из [эмулятора NES, разработанного Bisqwit](https://www.youtube.com/watch?v=QIUVSD3yqqE). Если вас интересует эмуляция или NES, настоятельно рекомендую его видеоролики.

Остальные версии C++ использует уже написанный код. Полная версия [здесь](https://justinmeiners.github.io/lc3-vm/src/lc3-alt.cpp).

```
{Includes, 12}

{Registers, 3}
{Condition Flags, 3}
{Opcodes, 3}

{Memory Mapped Registers, 11}
{TRAP Codes, 8}

{Memory Storage, 3}
{Register Storage, 3}

{Functions, 12}

int running = 1;
{Instruction C++, 14}
{Op Table, 14}

int main(int argc, const char* argv[])
{
    {Load Arguments, 12}
    {Setup, 12}

    enum { PC_START = 0x3000 };
    reg[R_PC] = PC_START;

    while (running)
    {
        uint16_t instr = mem_read(reg[R_PC]++);
        uint16_t op = instr >> 12;
        op_table[op](instr);
    }
    {Shutdown, 12}
}
```
